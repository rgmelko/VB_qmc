\documentclass[prl,aps,twocolumn,floatfix,amsmath,amssymb,superscriptaddress,tightenlines]{revtex4}
\usepackage{graphicx}
%\usepackage{epstopdf}
\usepackage{amsfonts}
\usepackage{bm}
\usepackage{color}
\begin{document}

\date{\today}
\title{Measuring Renyi Entanglement Entropy with Quantum Monte Carlo}

\author{Matthew B. Hastings}
\affiliation{Microsoft Research, Station Q, CNSI Building, University of California, Santa Barbara, CA, 93106}

\author{Iv\'an Gonz\'alez}
\affiliation{Centro de Supercomputaci\'on de Galicia, Avda.~de~Vigo~s/n, E-15705 Santiago de Compostela, Spain}

\author{Ann B. Kallin}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Ontario, N2L 3G1, Canada} 

\author{Roger G. Melko}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Ontario, N2L 3G1, Canada} 

\begin{abstract} 
We develop a procedure for measuring the entanglement entropy of a subregion $A$ in a quantum
many-body system
%using valence-bond basis quantum Monte Carlo simulations 
as the expectation of a unitary operator which swaps the 
basis states of $A$ with an ancillary copy of that region.  An algorithm for
calculating the Renyi entropy directly from this {\it Swap} operator
is possible via a quantum Monte Carlo procedure in the valence-bond basis.
An improved estimator involving the ratio of {\it Swap} operators for different subregions enables simulations to converge
the entropy using a number of samples that 
%appears to scale only polynomially in the region size.
scales polynomially in the subregion size.
We demonstrate that the Renyi entropy calculated for a Heisenberg chain  
converges to exact results. 
%provided by density matrix renormalization group calculations.  
Finally, we 
calculate the scaling of the Renyi entropy in the two-dimensional Heisenberg model and confirm that the N\'eel 
groundstate obeys the expected area law for systems up to linear size $L=28$.
\end{abstract}
\maketitle

{\it Introduction.}-- 
The measurement of entanglement in interacting quantum many-body systems has promised to provide
new tools and insights to the field of condensed-matter physics.  An important example is conformally invariant
systems in one dimension, which display universal logarithmic
scaling of entanglement entropy \cite{Cardy}.  In addition, many
quantum systems in two dimensions (2D) and higher are predicted to have ``area law''
scaling of entanglement entropy, with
either universal additive logarithmic corrections for critical systems \cite{corner,ryu} or
universal additive constant corrections for topologically ordered systems \cite{KP,LW}.
Thus, the study of entanglement entropy can provide an important new 
window into the understanding of universal behavior, a uniting concept across broad fields of experimental and theoretical 
physics.

Scalable simulation methods are crucial for the 
study of groundstate, finite-temperature, and critical properties of the plethora of systems of interest to condensed-matter physics.
Unfortunately, there are 
no known simulation methods to calculate entanglement entropy in $D>1$ for large quantum-many body systems.
The von Neumann entropy ($S_1$, defined below)
is accessible numerically, but only when the reduced density matrix can be calculated directly, such as in Lanczos 
or density matrix renormalization group (DMRG) methods.  Scalable simulation techniques in dimensions $D>1$,
are so far essentially
restricted to quantum Monte Carlo (QMC), which does not provide access to the reduced density matrix, but only approximates it
via a Metropolis importance-sampling algorithm. 

%Unfortunately, there are 
%no known simulation methods to calculate entanglement entropy in $D>1$ for large systems of interest in
%condensed matter.
% needed in order to study the groundstate, finite-temperature, and 
%critical properties of the vast majority of systems of interest to condensed-matter physics, are so far essentially
%restricted to quantum Monte Carlo (QMC) which does not provide access to the reduce density matrix but only approximates it
%via a Metropolis importance-sampling algorithm. 

We resolve this problem and show that a generalized Renyi entropy ($S_2$, defined below) can be represented in the valence-bond basis as the expectation
value of a unitary swap operator.  This swap operator is directly accessible as a simple expectation value in a QMC simulation scheme
constructed in the valence-bond basis.  Using QMC simulations, we calculate $S_2$ for a spin $1/2$ Heisenberg model
on 1D and 2D lattices.  In 1D, we demonstrate that $S_2$ calculated with QMC converges to the exact result obtained with DMRG simulations.  In 2D, we show that the leading order term in the scaling of $S_2$ goes like the boundary of a subregion $A$, 
confirming the area law expected in the N\'eel groudstate from recent studies \cite{Ann}.

The generalized Renyi entanglement entropies are defined by
\begin{equation}
S_{n} (\rho_A) = \frac{1}{1- n} \ln \left[{ {\rm Tr}\big( \rho_A^{n} \big) }\right],
\label{Sn}
\end{equation}
where $\rho_A$ is the reduced-density matrix of a subregion $A$ entangled with its complement $B$, and 
$n>0$.  In the limit $n \rightarrow 1$, one recovers the formal 
definition of the familiar von Neumann entropy, $S_1 (\rho_A) = - {\rm Tr}( \rho_A \ln \rho_A )$.  
Recently, the general Renyi entropies have attracted considerable attention in the condensed matter community, due to their ability to encode
information about the whole ``entanglement spectrum'' of $\rho_A$, together allowing the set of $S_{n}$ to contain 
much more information than $S_1$ alone \cite{Espec}.  For example, the concept of topological entanglement entropy has recently been
generalized to the family of Renyi entropies, where it has been shown to be equal to the logarithm of the total quantum 
dimension, $S_{\rm top} \propto \log {\mathcal D}$, independent of $n$ \cite{PI}.  Universal corrections to the scaling of $S_{n}$ 
have also been calculated in a field-theoretic treatment of the $O(N)$ model \cite{Max}.
In addition, it is useful to note that two Renyi entropies $S_{n}$ and $S_{m}$ obey the fundamental
inequality $S_{n} \geq S_{m}$ when $n < m$, making for example $S_2$ useful as a rigorous
lower bound on $S_1$.  

\begin{figure} {
\includegraphics[width=2.5
in]{swap_2.eps} \caption{(color online) 
\label{swap_2}
A valence-bond state on a six-site chain, with two non-interacting copies (top and bottom) before (a) and after (b) operation of the $Swap_A$ operator.  
The region A consists of three light-colored sites on the left; the entangled region B of three dark sites on the right.
}
} \end{figure}

{\it Valence-bond basis and the Swap operator.}-- We briefly review the notation of Sandvik, and refer the reader to 
Refs.~\cite{Sandvik,Beach,AWSloop} for additional details on the valence bond basis.
One begins by writing the expansion of a singlet
wavefunction $\Psi$ of $N$ spins as $N/2$ valence bonds:
\begin{equation}
| \Psi \rangle = \sum_r f_r|(a^r_1,b^r_1) \ldots (a^r_{N/2},b^r_{N/2}) \rangle = \sum_r f_r| V_r \rangle
\end{equation}
where the valence bonds are singlet pairs denoted by $(a,b) = (\lvert\uparrow_a \downarrow_b \rangle - \lvert\downarrow_a \uparrow_b\rangle)/\sqrt{2}$,
occuring between sites of the opposite sublattices of a bipartite lattice, and $r$ labels all possible tilings of bonds.  The coefficients $f_r$ are unknown, but an importance sampling scheme \cite{Sandvik} for the valence bond state $| V_r \rangle$ will be outlined below.  

In order to derive an estimator for $S_2$, it is necessary to construct two separate copies of the
system under consideration; one ``real'', one ``ancillary'' (Fig.~\ref{swap_2}).
%We now give an equivalent definition of
%the Renyi entropy $S_2$ as the expectation
%value of a swap operator on two copies of the system.  
%We first
%present a formal solution to the problem of measuring the entropy
%in QMC, Eq.~(\ref{ensembleavg}) below, as a QMC averge.
%We then explain how to better perform the statistical sampling for
%actual calculations.
Then, one defines an
operator $Swap_A$ which acts between the copies of the system, swapping the
configurations within region $A$.  To more precisely define the operator
$Swap_A$, one may write out its matrix elements in a product basis, e.g. the $S^z$ basis.
Let $|\alpha\rangle$  represent a complete basis of states in the subregion
$A$ and let $|\beta\rangle$ represent a complete basis of states in
the complement subregion $B$.  Then, $|\alpha_1 \rangle \otimes |\beta_1 \rangle$ represent
a complete basis of states for the ``real'' system, and
$\Bigl( |\alpha_1\rangle \otimes |\beta_1\rangle \Bigr) \otimes
\Bigl( |\alpha_2\rangle \otimes |\beta_2\rangle \Bigr)$
represent a complete basis of states for both copies of the system.
Define the operator $Swap_A$ by
\begin{eqnarray}
&& Swap_A \Bigl( |\alpha_1\rangle \otimes |\beta_1\rangle \Bigr) \otimes
\Bigl( |\alpha_2\rangle \otimes |\beta_2\rangle \Bigr) \nonumber \\ &&=
\Bigl( |\alpha_2\rangle \otimes |\beta_1\rangle \Bigr) \otimes
\Bigl( |\alpha_1\rangle \otimes |\beta_2\rangle \Bigr).
\end{eqnarray}
The operator $Swap_A$ is a unitary operator.
One immediately sees that the Renyi entropy is simply
\begin{eqnarray}
\label{H2fromSwap}
S_2(\rho_A) &=&-\ln(\langle \Psi\otimes \Psi|Swap_A|\Psi\otimes \Psi\rangle) \\
&=&-\ln(\langle Swap_A \rangle). \label{s2}
\end{eqnarray}
In the valence-bond basis, this relationship holds, although the simple expression of the wavefunction in terms
of a product basis is not possible.  Rather, the swap operator has the
effect of swapping the endpoint of a valence-bond between the real and ancillary copies in the region $A$.
%across the boundary of region $A$.
The $Swap_A$ operator is illustrated for a 1D lattice with six sites in Fig~\ref{swap_2}.  
There, two copies of the system are drawn before (a) and after (b) operation by the $Swap_A$ operator on a
valence-bond state $|V_r\rangle$.
%The result is an entangling of the valence bonds between the 
%real and ancillary systems across the boundary of region $A$.

{\it Measuring the Swap operator in QMC.}--
We now present a procedure for measuring the entropy $S_2$ via importance sampling of the $Swap_A$ operator in QMC.  A
projector scheme in the valence-bond basis has recently been pioneered by Sandvik \cite{Sandvik}, and we only briefly
review the notation here, referring the reader to Refs.~\cite{Sandvik,Beach,AWSloop} for details of implementation.
In short, the method is a $T=0$ projector QMC, where high powers of
a Hamiltonian $H$ are used to project out the ground state $|0\rangle$ from a trial wavefunction, 
$(-H)^m|\Psi \rangle \propto |0\rangle$.  In Sandvik's QMC scheme, $(-H)^m$ is written as a sum of all products of $m$ bond
operators,
\begin{equation}
(-H)^m = \sum_r \prod_{i=1}^m H_{a_i^r b_i^r} = \sum_r P_r,
\end{equation}
where for concreteness we use the spin 1/2 Heisenberg model, defining $H=-\sum_{\langle a,b \rangle}H_{ab}$ and 
$H_{ab} = -({\bf S}_a \cdot {\bf S}_b - 1/4)$.  The operator string $P_r$ is sampled according to its weight, $W_r$, accrued upon
evolution of a trial valence-bond state $|V \rangle$ under projection:
\begin{equation}
P_r |V \rangle = W_r |V(r) \rangle.
\end{equation}
As shown in Ref.~\cite{Sandvik}, for the Heisenberg model, $W_r$ is simply related to the number of off-diagonal 
operations $m_{\rm off}$ in the projection, $W_r = 2^{-m_{\rm off}}$.

To sample the $Swap_A$ operator, one requires a double-projector valence-bond QMC scheme \cite{Sandvik}, where
a general expectation value for any observable $\mathcal{O}$ is given by
\begin{equation}
\label{expect}
\langle \mathcal{O} \rangle = \frac{\sum_{rl} \langle V | P_l^* \mathcal{O} P_r | V \rangle} {\sum_{rl} \langle V | P_l^* P_r | V \rangle} 
= \frac{\sum_{rl} W_l W_r \langle V(l) | \mathcal{O} | V(r) \rangle} {\sum_{rl} W_l W_r \langle V(l) | V(r) \rangle}
\end{equation} 
In this case, the two projectors are applied to two copies of the system; 
the expectation value of the $Swap_A$ operator as illustrated in Fig.~\ref{swap_2} 
can then be calculated directly.  Specifically, one 
performs importance sampling of operator strings according to the weight $W_l W_r \langle V(l) | V(r) \rangle$, and measures
the QMC average expectation value
\begin{equation}
\langle Swap_A \rangle =  \left\langle{ \frac{ \langle V(l) | Swap_A | V(r) \rangle}{\langle V(l) | V(r) \rangle}  }\right\rangle,
\label{Swap}
\end{equation}
calculating $S_2$ from Eq.~\eqref{s2}.

\begin{figure} {
\includegraphics[width=2.8in]{L100_fig2.eps} \caption{(color online) 
\label{1Dfig}
The Renyi entropy $S_2$ as a function of site index $i \in A$, for a 100-site Heisenberg chain with open boundaries, 
calculated with DMRG and QMC.  Data labelled ``Swap'' was obtained from Eq.~\eqref{Swap} with one simulation, whereas 
data labelled $j_{\rm max}=5$ was calculated with Eq.~\eqref{Ratio} using 19 separate simulations with a range of  $j \in [1,5]$.  The inset shows the convergence of $S_2$ to the exact value (dashed line) with $i=6$ up to $m=4000$.
}
} \end{figure}

Results for a 1D chain are illustrated in Fig.~\ref{1Dfig}.  There, simulations were performed using a double-projector QMC,  where
the trial state $| V \rangle$ is a simple ``columnar'' state (alternating nearest-neighbor bonds in 1D).  In the following data, four random bond operators were changed in the operator string per Monte Carlo step, and (unless otherwise
stated) $m=40N$.  Exact results for $S_2$ were obtained with a DMRG simulation, converged with 1000 states.  One 
immediately sees that the naive expectation value $\langle Swap_A \rangle$ results in a grossly incorrect result when the region
$A$ grows large (in 1D, $A$ is the linear region of size $i$).   
In fact, for $i > 25$ in Fig.~\ref{1Dfig}, the Renyi entropy calculated with Eq.~\eqref{Swap} develops a discrepancy from the
exact value that cannot be accounted for by statistical fluctuations (error bars are one standard deviation).  
One may understand this incorrect result by considering the expected scaling of $S_2$.  Namely,
$S_2$ scales logarithmically with the size of $A$, so the expectation value
$\langle Swap_A \rangle$ should be polynomially small in $A$.  As a result, there
are only very
few configurations contributing significantly to $\langle Swap_A \rangle$, so the importance  sampling is in practice done incorrectly,
jeopardizing simulation ergodicity \footnote{The valence bond basis does alleviate this problem, compared to the
$S^z$ basis, in some systems; for example, a valence
bond crystal can have an exponentially small $\langle Swap_A \rangle$, without having {\it any} realization-to-realization fluctuations,
while in the $S^z$ basis the expectation value  in a given realization is either $0$ or $1$.}.
The problem is even worse in 2D and higher, where the expectation value 
$\langle Swap_A \rangle$ should be exponentially small in $A$.

To combat this issue, we propose a refinement to the algorithm, which we called ``improved ratio'' sampling.
Consider first a one-dimensional chain, and define regions $A^1,A^2,...,A^n$, such
that $A^i$ contains $i$ sites, and $A^i$ is a subset of $A^{i+1}$.  In other words, each region $A^{i+1}$ is obtained by adding one site to region
$A^{i}$, and region $A^0$ is the empty set (thus, $Swap_{A^0}$ is equal to the identity operator).
In a given simulation, one can calculate the ratio
\begin{equation}
\frac{\langle Swap_{A^{i+1}}\rangle}{\langle Swap_{A^{i}}\rangle}
= \frac{\sum_{rl} W_l W_r \langle V(l) | Swap_{A^{i+1}} | V(r) \rangle} {\sum_{rl} W_l W_r \langle V(l) | Swap_{A^i} | V(r) \rangle}
\label{Ratio}
\end{equation}
where, for each $i=0,...,n-1$, the log of this ratio is equal to minus the difference $S_2(\rho_{A^{i+1}})-S_2(\rho_{A^{i}})$.
Computing this ratio for each $i$ will let us compute $S_2$ for all $A^i$.  To calculate this ratio, the simulation must be performed 
with the modified sampling weight,
\begin{equation}
W_l W_r \langle V(l) | Swap_{A^i} | V(r) \rangle,
\end{equation}
i.e., a unique QMC simulation must be done for each desired $i$.  %Thus, our simple double-projector algorithm, which scales 
%approximately as $~{\rm max}(m^2, N)$ \cite{AWSloop}, obtains an additional multiplicative factor of $N$ in the scaling.  
If every site were used for a different simulation weight, the QMC algorithm would obtain an additional multiplicative factor of $N$ in its scaling.
In practice, 
this can be reduced by noting that good statistical control can be retained by calculating 
${\langle Swap_{A^{i+j}}\rangle}/{\langle Swap_{A^{i}}\rangle}$ for fixed $i$ and a range of $j \in [1,j_{\max}]$ (see also the Discussion).  We illustrate this in Fig.~\ref{1Dfig},
where simulations with $j_{\rm max}=5$ are sufficient to converge 100-site chain to the exact results along most of its length.

{\it 2D Heisenberg Results.}-- We now extend these concepts to QMC simulations of the spin 1/2 Heisenberg model on $N=L \times L$ lattices.  We define the entangled region $A^\ell$ as a square region of linear length $\ell$ encompassing $\ell \times \ell$ sites.  We calculate the expectation value of both $\langle Swap_A \rangle$ (Eq.~\ref{Swap}) directly using one simulation, as well as the improved ratio estimator ${\langle Swap_{A^{\ell+r}}\rangle}/{\langle Swap_{A^{\ell}}\rangle}$.  Here, both $\ell$ and $r$ are variables denoting the linear dimension of $A$; i.e. $A^{\ell+r}$ contains $2\ell r+r^2$ more sites than $A^{\ell}$.

\begin{figure} {
\includegraphics[width=2.8in]{L8n12_ratio.eps} \caption{(color online) 
\label{L16fig}
The Renyi entropy divided by the linear dimension $\ell$ of the entangled region $A$, for 2D lattices with $L=8$ and $L=12$.  The data labelled ``Swap'' is from a single simulation calculating Eq.~\eqref{Swap} directly.  The other
data sets are derived from the improved ratio estimator, Eq.~\eqref{Ratio}, with different ranges of $r \in [1,r_{\rm max}]$ (see text).  The inset 
is a periodic $L=8$ lattice with region $A$ consisting of the 16 central (dark) sites labelled by $\ell = 4$.
}
} \end{figure}

Figure \ref{L16fig} illustrates $S_2$ on two 2D Heisenberg models with  $L=8$ and  $L=12$.  In the case of $L=8$, data for a single 
simulation calculating $\langle Swap_A \rangle$ directly is identical to the improved ratio estimators for all except the largest $\ell$.  
Here, the direct estimator (Eq~\eqref{Swap}) corresponds to one simulation, whereas $r_{\rm max}=1$ corresponds to 6 different simulations of the improved ratio estimator ${\langle Swap_{A^{\ell+1}}\rangle}/{\langle Swap_{A^{\ell}}\rangle}$ and $\ell \in [1,6]$.
In contrast to $L=8$, for $L=12$ the direct estimator is significantly different than 
the improved ratio estimator.  We can see the convergence of the data as one successively decreases the range of $r \in [1,r_{\rm max}]$, 
so that $r_{\rm max}=2$ is identical to $r_{\rm max}=1$, which is the smallest possible range for the improved ratio estimator in the 2D geometry illustrated.  It is important to note that for large $r_{\rm max}$ the correct value of $S_2$ does {\it not} lie within the error bars of the data.  
%This is an indication that the algorithm will not converge to the expected result in polynomial time, since the expectation value is exponentially decreasing.
This is an indication that simulation ergodicity is jeopardized by low sampling of the $Swap$ operator, similar to that observed in 1D.

\begin{figure} {
\includegraphics[width=3.1in]{fig4.eps} \caption{(color online) 
\label{fig4}
Scaling of the Renyi entropy divided by the linear dimension $\ell$ of the entangled region $A$ for different systems sizes
in 2D.  All data is calculated with the improved ratio estimator, Eq.~\eqref{Ratio}, with different $r_{\rm max}=1$.  
}
} \end{figure}

We use the improved ratio estimator with $r_{\max}=1$ to scale the results for the Renyi entropy of the Heisenberg model to larger system sizes in 2D.  Results are given in Fig.~\ref{fig4} for $L=4$ to $L=28$, plotted as $S_2/\ell$.  From  Ref.~\cite{Ann}
one expects the scaling of $S_1$ in the N\'eel state to obey the area law; also recall that $S_2 \leq S_1$.  
The data illustrated is clearly consistent with the area law $S_2/\ell
\sim {\rm const.}$ for $\ell \ll L$, at which point boundary 
effects likely become important.  In particular, multiplicative log corrections (which were apparent in similar system sizes and geometries for the Valence-Bond entanglement entropy
\cite{Alet,Chh}) are not present.

{\it Discussion.}-- 
In this paper we have presented a numerical algorithm for measuring the Renyi entropy in valence-bond QMC simulations via
the expectation value of a swap operator between two copies of the system.
Using an improved ratio estimator, we are able to converge the expectation value of the swap operator to the exact
result on a 1D Heisenberg chain.
Using the same procedure, we have presented the first measurement of the Renyi entanglement entropy in a two dimensional system, confirming the area law for the N\'eel groundstate of the Heisenberg model.
%Using the improved ratio estimator, we were able to converge the expectation value of the swap operator.

The simple double-projector QMC algorithm used in this paper is known to scale approximately as $O(m^2)$, \cite{AWSloop}
assuming $m >N$ and remembering that two copies of a $N=L \times L$ lattices are needed to measure the Renyi
 entropy.
  The current simulation results for the direct swap expectation value, Eq~\eqref{Swap}, therefore also have
 $O(m^2)$ scaling, whereas results obtained using the improved ratio estimator Eq.~\eqref{Ratio} have $O(Lm^2)$ scaling in the current geometries.
We note however that these geometries may not be ideal for very large $\ell$ and $L$, even in the improved ratio sampling.
For example for $L=28$ and  $\ell=L/2$, we found a relative error between $r_{\rm max}=2$ and $r_{\rm max}=1$ of less than 0.04 (the
results for $S_2$ remaining identical within error bars); however for $\ell$ significantly larger than $L/2$, the statistical sampling error
increases dramatically and results for $S_2$ using  $r_{\rm max}=2$ and $r_{\rm max}=1$ begin to deviate outside of error bars,
indicating a lack of ergodicity in $r_{\rm max}=2$ at least.  
This being noted, it is of course true that in practice for such large $\ell$, one would prefer to do the simulation by measuring the 
expectation value of the swap operator on the complement of $A$, not on $A$ itself.

From the current work (which took less than 10 CPU years of resources), 
the question naturally arises whether it is possible to converge the expectation value of the swap operator on
larger system sizes, especially in light of the desire to test more fully the convergence of $r_{\rm max}=1$ on large $L$ and $\ell$.
We note first that it is easy to change the sequence of regions $A^i$ that one uses in the improved ratio estimator.
Rather, than considering a sequence of regions $A^{\ell}$ consisting of $\ell$-by-$\ell$ squares, 
we can use a more finely grained sequence of regions; e.g. by defining $A^i$ to contain
$i$ sites such that for $i=\ell^2$, $A^i$ is an $\ell$-by-$\ell$ square.  Incrementing the number of sites in $i$ by one would result in
(at worst) $O(Nm^2)$ scaling in the current algorithm.  

However, we also note that recently-developed {\it loop} algorithms
result in significant improvement in scaling, allowing for the convergence of observables such as energy and spin correlation functions for $L=256$ and larger \cite{AWSloop}.  In these schemes, the scaling of the direct swap operator (Eq.~\eqref{Swap}), like
other observables, decreases to $O(m)$, while the expected scaling of the improved ratio estimator would be $O(Nm)$ at worst, depending
on the definitions of the $A^i$ regions.
% Since at each stage we only change the region locally, building up  a square of size $\ell+1$ by adding sites one at a time around the edge, we 
We therefore expect that
the algorithm will require only a polynomial number of samples for convergence of arbitrary system sizes.


{\it Acknowledgments.}-- The authors thank Kevin Beach ...
This work was made possible by the
computing facilities of SHARCNET and CESGA.  Support was provided by NSERC
of Canada (R.G.M.).

\bibliography{Biblio}

\end{document}
